# ä»¥å¤ªåŠUSDTæˆæƒè„šæœ¬ä½¿ç”¨è¯´æ˜

## åŠŸèƒ½æè¿°
`eth_usdt_approval.py` æ˜¯ä¸€ä¸ªç”¨äºåœ¨ä»¥å¤ªåŠä¸»ç½‘ä¸ŠæˆæƒUSDTä½¿ç”¨çš„Pythonè„šæœ¬ã€‚å®ƒå¯ä»¥ï¼š

1. æ£€æŸ¥é’±åŒ…ETHå’ŒUSDTä½™é¢
2. æŸ¥çœ‹å½“å‰USDTæˆæƒé¢åº¦  
3. å‘æŒ‡å®šåˆçº¦æˆæƒUSDTä½¿ç”¨æƒé™
4. å¤„ç†ä»£ç†åˆçº¦çš„æƒ…å†µ
5. æ”¯æŒEIP-1559å’Œlegacyäº¤æ˜“ç±»å‹
6. æä¾›æ¨¡æ‹Ÿå’Œå®é™…å‘é€ä¸¤ç§æ¨¡å¼

## ç›®æ ‡åˆçº¦
- **ç›®æ ‡åˆçº¦åœ°å€**: `0x6503de9fe77d256d9d823f2d335ce83ece9e153f`
- **USDTåˆçº¦åœ°å€**: `0xdAC17F958D2ee523a2206206994597C13D831ec7`

## å®‰è£…ä¾èµ–

```bash
pip install web3
```

## ç¯å¢ƒå˜é‡è®¾ç½®

### å¿…éœ€ç¯å¢ƒå˜é‡
```bash
# ä»¥å¤ªåŠRPCèŠ‚ç‚¹URLï¼ˆæ¨èä½¿ç”¨Infuraã€Alchemyç­‰ï¼‰
export ETH_RPC_URL="https://eth-mainnet.g.alchemy.com/v2/YOUR_API_KEY"

# ç§é’¥ï¼ˆå¯é€‰ï¼Œå¦‚æœåªæŸ¥è¯¢çŠ¶æ€å¯ä»¥ä¸è®¾ç½®ï¼‰
export ETH_PRIVATE_KEY="your_private_key_here"
```

### RPCèŠ‚ç‚¹è·å–æ–¹å¼
1. **Infura**: https://infura.io/
2. **Alchemy**: https://alchemy.com/
3. **QuickNode**: https://quicknode.com/

## ä½¿ç”¨æ–¹æ³•

### 1. åŸºæœ¬ä½¿ç”¨
```bash
cd /Users/scottliyq/go/hardhat_space/chain_monitor
python eth_usdt_approval.py
```

### 2. åªæŸ¥è¯¢çŠ¶æ€ï¼ˆæ— éœ€ç§é’¥ï¼‰
å¦‚æœæ²¡æœ‰è®¾ç½®ç§é’¥ï¼Œè„šæœ¬ä¼šè¿›å…¥åªè¯»æ¨¡å¼ï¼Œå¯ä»¥æŸ¥è¯¢ä»»æ„åœ°å€çš„çŠ¶æ€ã€‚

### 3. äº¤äº’å¼æ“ä½œ
è„šæœ¬è¿è¡Œåä¼šæ˜¾ç¤ºèœå•ï¼š
```
è¯·é€‰æ‹©æ“ä½œ:
1. æˆæƒUSDT (æ¨¡æ‹Ÿ)
2. æˆæƒUSDT (å®é™…å‘é€)  
3. æ£€æŸ¥çŠ¶æ€
4. é€€å‡º
```

## å®‰å…¨æ³¨æ„äº‹é¡¹

### âš ï¸ é‡è¦è­¦å‘Š
1. **ç§é’¥å®‰å…¨**: æ°¸è¿œä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç ç§é’¥
2. **æµ‹è¯•å…ˆè¡Œ**: é¦–æ¬¡ä½¿ç”¨å»ºè®®ç”¨æ¨¡æ‹Ÿæ¨¡å¼æµ‹è¯•
3. **Gasè´¹ç”¨**: ç¡®ä¿è´¦æˆ·æœ‰è¶³å¤ŸETHæ”¯ä»˜gasè´¹ç”¨
4. **ç½‘ç»œç¡®è®¤**: ç¡®è®¤è¿æ¥çš„æ˜¯ä»¥å¤ªåŠä¸»ç½‘

### ğŸ” ç§é’¥ç®¡ç†å»ºè®®
```bash
# æ–¹æ³•1: ç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰
export ETH_PRIVATE_KEY="0x..."

# æ–¹æ³•2: .envæ–‡ä»¶
echo "ETH_PRIVATE_KEY=0x..." > .env

# æ–¹æ³•3: ç¡¬ä»¶é’±åŒ…ï¼ˆæœ€å®‰å…¨ï¼‰
# å¯ä»¥ä¿®æ”¹ä»£ç æ”¯æŒç¡¬ä»¶é’±åŒ…ç­¾å
```

## ä»£ç åŠŸèƒ½è¯¦è§£

### ä¸»è¦ç±»: USDTApprovalManager

#### åˆå§‹åŒ–
```python
manager = USDTApprovalManager(rpc_url, private_key=None)
```

#### æŸ¥è¯¢æ–¹æ³•
```python
# è·å–USDTä½™é¢
balance = manager.get_usdt_balance(address)

# è·å–æˆæƒé¢åº¦
allowance = manager.get_usdt_allowance(owner, spender)

# æ£€æŸ¥ä»£ç†å®ç°
impl = manager.check_proxy_implementation()
```

#### æˆæƒæ–¹æ³•
```python
# æ¨¡æ‹Ÿæˆæƒ
result = manager.approve_usdt(amount, dry_run=True)

# å®é™…æˆæƒ
result = manager.approve_usdt(amount, dry_run=False)
```

## ä»£ç†åˆçº¦å¤„ç†

è„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹ä»£ç†åˆçº¦ï¼š

1. **æ–¹æ³•è°ƒç”¨**: å°è¯•è°ƒç”¨ `implementation()` æ–¹æ³•
2. **å­˜å‚¨æ§½è¯»å–**: ä½¿ç”¨EIP-1967æ ‡å‡†å­˜å‚¨æ§½
3. **è‡ªåŠ¨é€‚é…**: æ ¹æ®æ£€æµ‹ç»“æœè°ƒæ•´è°ƒç”¨æ–¹å¼

## Gasè´¹ç”¨ä¼˜åŒ–

### EIP-1559æ”¯æŒ
- è‡ªåŠ¨æ£€æµ‹ç½‘ç»œæ”¯æŒæƒ…å†µ
- åŠ¨æ€è®¡ç®—base feeå’Œpriority fee
- æ™ºèƒ½å›é€€åˆ°legacyäº¤æ˜“

### Gasä¼°ç®—
- è‡ªåŠ¨ä¼°ç®—äº¤æ˜“gasé™åˆ¶
- å¢åŠ 20%å®‰å…¨ä½™é‡
- å®æ—¶æ˜¾ç¤ºé¢„è®¡è´¹ç”¨

## é”™è¯¯å¤„ç†

### å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

1. **è¿æ¥å¤±è´¥**
   ```
   é”™è¯¯: æ— æ³•è¿æ¥åˆ°ä»¥å¤ªåŠèŠ‚ç‚¹
   è§£å†³: æ£€æŸ¥RPC_URLæ˜¯å¦æ­£ç¡®ï¼Œç½‘ç»œæ˜¯å¦æ­£å¸¸
   ```

2. **ä½™é¢ä¸è¶³**
   ```
   é”™è¯¯: ä½™é¢ä¸è¶³
   è§£å†³: ç¡®ä¿è´¦æˆ·æœ‰è¶³å¤Ÿçš„USDTå’ŒETH
   ```

3. **Gasä¼°ç®—å¤±è´¥**
   ```
   é”™è¯¯: gasä¼°ç®—å¤±è´¥
   è§£å†³: è„šæœ¬ä¼šä½¿ç”¨é»˜è®¤å€¼ï¼Œé€šå¸¸å¯ä»¥æ­£å¸¸æ‰§è¡Œ
   ```

4. **äº¤æ˜“å¤±è´¥**
   ```
   é”™è¯¯: äº¤æ˜“è¢«å›æ»š
   è§£å†³: æ£€æŸ¥åˆçº¦çŠ¶æ€ï¼Œå¯èƒ½éœ€è¦è°ƒæ•´gasä»·æ ¼
   ```

## è¾“å‡ºç¤ºä¾‹

### çŠ¶æ€æ£€æŸ¥
```
ğŸ“Š çŠ¶æ€æ£€æŸ¥ - 0x742d35Cc6635C0532925a3b8d5c9b37D36d2...
============================================================
ğŸ’° ETHä½™é¢: 1.234567 ETH
ğŸ’° USDTä½™é¢: 10,000.00 USDT  
ğŸ” USDTæˆæƒé¢åº¦: 0.00 USDT
ğŸ“‹ ä»£ç†åˆçº¦å®ç°åœ°å€: 0x...
â›½ Gas (EIP-1559): base=20.5 gwei
```

### æˆæƒäº¤æ˜“
```
ğŸ¯ å‡†å¤‡æˆæƒ 1,000.00 USDT ç»™åˆçº¦ 0x6503de9fe77d256d9d823f2d335ce83ece9e153f
ğŸ“Š å½“å‰USDTä½™é¢: 10,000.00
ğŸ“Š å½“å‰æˆæƒé¢åº¦: 0.00 USDT
â›½ ä¼°ç®—gasé™åˆ¶: 65,000
ğŸ’° é¢„è®¡äº¤æ˜“è´¹ç”¨: 0.001300 ETH
âœ… äº¤æ˜“å·²å‘é€!
ğŸ”— äº¤æ˜“å“ˆå¸Œ: 0x...
ğŸ”— Etherscan: https://etherscan.io/tx/0x...
âœ… äº¤æ˜“ç¡®è®¤æˆåŠŸ!
ğŸ“Š æ–°æˆæƒé¢åº¦: 1,000.00 USDT
```

## æ‰©å±•åŠŸèƒ½

### æ‰¹é‡æˆæƒ
å¯ä»¥ä¿®æ”¹è„šæœ¬æ”¯æŒæ‰¹é‡æˆæƒå¤šä¸ªåˆçº¦ï¼š

```python
contracts = [
    "0x6503de9fe77d256d9d823f2d335ce83ece9e153f",
    "0x...",  # å…¶ä»–åˆçº¦åœ°å€
]

for contract in contracts:
    result = manager.approve_usdt_to_contract(contract, amount)
```

### å®šæ—¶æ£€æŸ¥
å¯ä»¥æ·»åŠ å®šæ—¶æ£€æŸ¥åŠŸèƒ½ï¼š

```python
import schedule
import time

def check_allowances():
    for contract in contracts:
        allowance = manager.get_usdt_allowance(my_address, contract)
        if allowance < threshold:
            print(f"âš ï¸ {contract} æˆæƒé¢åº¦ä¸è¶³: {allowance}")

schedule.every(1).hours.do(check_allowances)
```

## æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š

1. **ç½‘ç»œè¿æ¥**: ç¡®ä¿RPCèŠ‚ç‚¹å¯è®¿é—®
2. **APIå¯†é’¥**: ç¡®ä¿Infura/Alchemy APIå¯†é’¥æœ‰æ•ˆ
3. **è´¦æˆ·ä½™é¢**: ç¡®ä¿æœ‰è¶³å¤Ÿçš„ETHå’ŒUSDT
4. **åˆçº¦çŠ¶æ€**: åœ¨Etherscanä¸Šç¡®è®¤åˆçº¦çŠ¶æ€æ­£å¸¸
5. **Gasä»·æ ¼**: ç½‘ç»œæ‹¥å µæ—¶å¯èƒ½éœ€è¦æé«˜gasä»·æ ¼

## å…è´£å£°æ˜

æœ¬è„šæœ¬ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ã€‚ä½¿ç”¨å‰è¯·ï¼š

- å……åˆ†ç†è§£ä»£ç é€»è¾‘
- åœ¨æµ‹è¯•ç½‘ç»œä¸ŠéªŒè¯
- ç¡®ä¿ç§é’¥å®‰å…¨
- è‡ªè¡Œæ‰¿æ‹…ä½¿ç”¨é£é™©

ä½œè€…ä¸å¯¹ä½¿ç”¨æœ¬è„šæœ¬é€ æˆçš„ä»»ä½•æŸå¤±è´Ÿè´£ã€‚